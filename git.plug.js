var mod=(()=>{var p=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var u=(t,e)=>{for(var n in e)p(t,n,{get:e[n],enumerable:!0})},D=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of C(e))!k.call(t,i)&&i!==n&&p(t,i,{get:()=>e[i],enumerable:!(o=A(e,i))||o.enumerable});return t};var S=t=>D(p({},"__esModule",{value:!0}),t);var he={};u(he,{functionMapping:()=>M});function P(t){let e=atob(t),n=e.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=e.charCodeAt(i);return o}function U(t,e){return syscall("sandboxFetch.fetch",t,e)}function h(){globalThis.fetch=async function(t,e){let n=await U(t,e&&{method:e.method,headers:e.headers,body:e.body});return new Response(n.base64Body?P(n.base64Body):null,{status:n.status,headers:n.headers})}}typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var f=new Map,d=0;function g(t){self.postMessage(t)}self.syscall=async(t,...e)=>await new Promise((n,o)=>{d++,f.set(d,{resolve:n,reject:o}),g({type:"sys",id:d,name:t,args:e})});function v(t,e){self.addEventListener("message",n=>{(async()=>{let o=n.data;switch(o.type){case"inv":{let i=t[o.name];if(!i)throw new Error(`Function not loaded: ${o.name}`);try{let s=await Promise.resolve(i(...o.args||[]));g({type:"invr",id:o.id,result:s})}catch(s){console.error(s),g({type:"invr",id:o.id,error:s.message})}}break;case"sysr":{let i=o.id,s=f.get(i);if(!s)throw Error("Invalid request id");f.delete(i),o.error?s.reject(new Error(o.error)):s.resolve(o.result)}break}})().catch(console.error)}),g({type:"manifest",manifest:e})}h();var a=self.syscall;var l={};u(l,{run:()=>T});function T(t,e){return a("shell.run",t,e)}typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});var r=self.syscall;var m={};u(m,{confirm:()=>ie,dispatch:()=>ne,downloadFile:()=>Y,filterBox:()=>H,flashNotification:()=>z,getCurrentPage:()=>L,getCursor:()=>G,getSelection:()=>K,getText:()=>B,getUiOption:()=>se,hidePanel:()=>X,insertAtCursor:()=>re,insertAtPos:()=>Z,moveCursor:()=>te,navigate:()=>j,openUrl:()=>_,prompt:()=>oe,reloadPage:()=>W,replaceRange:()=>ee,save:()=>Q,setPage:()=>N,setSelection:()=>V,setUiOption:()=>ae,showPanel:()=>J,vimEx:()=>le});function L(){return r("editor.getCurrentPage")}function N(t){return r("editor.setPage",t)}function B(){return r("editor.getText")}function G(){return r("editor.getCursor")}function K(){return r("editor.getSelection")}function V(t,e){return r("editor.setSelection",t,e)}function Q(){return r("editor.save")}function j(t,e,n=!1,o=!1){return r("editor.navigate",t,e,n,o)}function W(){return r("editor.reloadPage")}function _(t){return r("editor.openUrl",t)}function Y(t,e){return r("editor.downloadFile",t,e)}function z(t,e="info"){return r("editor.flashNotification",t,e)}function H(t,e,n="",o=""){return r("editor.filterBox",t,e,n,o)}function J(t,e,n,o=""){return r("editor.showPanel",t,e,n,o)}function X(t){return r("editor.hidePanel",t)}function Z(t,e){return r("editor.insertAtPos",t,e)}function ee(t,e,n){return r("editor.replaceRange",t,e,n)}function te(t,e=!1){return r("editor.moveCursor",t,e)}function re(t){return r("editor.insertAtCursor",t)}function ne(t){return r("editor.dispatch",t)}function oe(t,e=""){return r("editor.prompt",t,e)}function ie(t){return r("editor.confirm",t)}function se(t){return r("editor.getUiOption",t)}function ae(t,e){return r("editor.setUiOption",t,e)}function le(t){return r("editor.vimEx",t)}var y=class{listPages(e=!1){return r("space.listPages",e)}getPageMeta(e){return r("space.getPageMeta",e)}readPage(e){return r("space.readPage",e)}writePage(e,n){return r("space.writePage",e,n)}deletePage(e){return r("space.deletePage",e)}listPlugs(){return r("space.listPlugs")}listAttachments(){return r("space.listAttachments")}getAttachmentMeta(e){return r("space.getAttachmentMeta",e)}readAttachment(e){return r("space.readAttachment",e)}writeAttachment(e,n,o){return r("space.writeAttachment",e,n,o)}deleteAttachment(e){return r("space.deleteAttachment",e)}readFile(e,n){return r("space.readFile",e,n)}getFileMeta(e){return r("space.getFileMeta",e)}writeFile(e,n,o){return r("space.writeFile",e,n,o)}deleteFile(e){return r("space.deleteFile",e)}listFiles(e){return r("space.listFiles",e)}},ue=new y;var c={};u(c,{getEnv:()=>ye,invokeCommand:()=>pe,invokeFunction:()=>ge,listCommands:()=>de,reloadPlugs:()=>fe});function ge(t,e,...n){return r("system.invokeFunction",t,e,...n)}function pe(t){return r("system.invokeCommand",t)}function de(){return r("system.listCommands")}function fe(){r("system.reloadPlugs")}function ye(){return r("system.getEnv")}async function x(t){t||(t="Snapshot"),console.log("Snapshotting the current space to git with commit message",t);let{code:e}=await l.run("git",["add","./*.md"]);console.log("Git add code",e);try{await l.run("git",["commit","-a","-m",t])}catch{}console.log("Done!")}async function b(){let t=await m.prompt("Revision name:");t||(t="Snapshot"),console.log("Revision name",t),await c.invokeFunction("server","commit",t)}async function F(){await m.flashNotification("Syncing with git"),await c.invokeFunction("server","sync"),await m.flashNotification("Git sync complete!")}async function w(){console.log("Going to sync with git"),await x(),console.log("Then pulling from remote"),await l.run("git",["pull"]),console.log("And then pushing to remote"),await l.run("git",["push"]),console.log("Done!")}var M={snapshotCommand:b,syncCommand:F,commit:x,sync:w},Pe={name:"git",imports:["https://get.silverbullet.md/global.plug.json"],requiredPermissions:["shell"],functions:{snapshotCommand:{path:"./git.ts:snapshotCommand",env:"client",command:{name:"Git: Snapshot"}},syncCommand:{path:"./git.ts:syncCommand",env:"client",command:{name:"Git: Sync"}},commit:{path:"./git.ts:commit",env:"server"},sync:{path:"./git.ts:sync",env:"server"}},assets:{}};v(M,Pe);return S(he);})();
